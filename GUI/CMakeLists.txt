# CMakeList.txt: GUI 的 CMake 專案，在此包含來源及定義
# 引入cmake 模組 cmake/QtUtils.cmake
include(QtUtils)
# 執行QtUtils 的巨集(macro)
msvc_registry_search()
find_qt5(Core Widgets)

# 將來源新增到此專案的可執行檔。
add_executable(Textractor WIN32 
	main.cpp
	mainwindow.cpp
	extenwindow.cpp
	host/exception.cpp
	host/host.cpp
	host/textthread.cpp
	host/hookcode.cpp
	Textractor.rc
	Textractor.ico
)
target_precompile_headers(Textractor REUSE_FROM pch)
target_link_libraries(Textractor Qt5::Widgets shell32 winhttp)

if (NOT EXISTS ${CMAKE_FINAL_OUTPUT_DIRECTORY}/Qt5Core.dll AND NOT EXISTS ${CMAKE_FINAL_OUTPUT_DIRECTORY}/Qt5Cored.dll)
	add_custom_command(TARGET Textractor
		POST_BUILD
		COMMAND ${CMAKE_COMMAND} -E remove_directory "${CMAKE_CURRENT_BINARY_DIR}/windeployqt"
		COMMAND set PATH=%PATH%$<SEMICOLON>${qt5_install_prefix}/bin
		COMMAND Qt5::windeployqt --dir ${CMAKE_FINAL_OUTPUT_DIRECTORY} "${CMAKE_FINAL_OUTPUT_DIRECTORY}/Textractor.exe"
	)
endif()
